{"version":3,"file":"_C_WgvWUj.js","sources":["../../../src/components/local-let.marko"],"sourcesContent":["export interface Input<T> {\n  value: T;\n  key: string;\n}\nstatic declare global {\n  interface WindowEventMap {\n    \"local-storage-update\": CustomEvent<StorageEvent>;\n  }\n}\n\n<let/internalValue=input.value/>\n\n<script>\n  const existingValue = localStorage.getItem(input.key);\n  if (existingValue) {\n    internalValue = JSON.parse(existingValue);\n  }\n  /** TODO(hoisting bug): this should happen automatically */\n  const input_key = input.key;\n  const handleStorageChange = (e: StorageEvent) => {\n    if (e.key === input_key) {\n      internalValue = JSON.parse(e.newValue ?? \"\");\n    }\n  };\n  window.addEventListener(\"storage\", handleStorageChange, {\n    signal: $signal,\n  });\n  window.addEventListener(\n    \"local-storage-update\",\n    (e) => handleStorageChange(e.detail),\n    {\n      signal: $signal,\n    },\n  );\n</script>\n\n<return=internalValue valueChange(newValue) {\n  newValue = JSON.stringify(newValue);\n  localStorage.setItem(input.key, newValue);\n  window.dispatchEvent(\n    new CustomEvent(\"local-storage-update\", {\n      detail: {\n        key: input.key,\n        newValue,\n        storageArea: localStorage,\n      },\n    }),\n  );\n}/>\n"],"names":["internalValue","_$","_input_key","_scope","input_key","_valueChange","_input_value","input_value","_internalValue","_input__effect","input","existingValue","localStorage","getItem","key","JSON","parse","handleStorageChange","e","newValue","window","addEventListener","signal","detail","_input_","value","stringify","setItem","dispatchEvent","CustomEvent","storageArea"],"mappings":"8HAoCQA,CAAa,EAAA,IAAAC,CAAA,EAAAC,EAAAD,EAAA,EAAA,CAAAE,EAAAC,IAAAH,EAAAE,EAAAE,EAAAF,CAAA,CAAA,CAAA,EAAAG,EAAAL,KAAAE,EAAAI,IAAAC,EAAAL,EA1BFI,CAAW,MAAAC,CAAA,EAAAC,EAAAR,QAAAE,EAAA,CAAA,EAAAO,CAAA,IAAA,CAAA,CAG5B,MAAMC,EAAgBC,aAAaC,QAAQH,EAAMI,GAAG,EAChDH,GACFH,EAAAL,EAAgBY,KAAKC,MAAML,CAAa,CAAC,EAG3C,MAAMP,EAAYM,EAAAI,IACZG,EAAuBC,GAAoB,CAC3CA,EAAEJ,MAAQV,GACZI,EAAAL,EAAgBY,KAAKC,MAAME,EAAEC,UAAY,EAAE,CAAC,CAE/C,EACDC,OAAOC,iBAAiB,UAAWJ,EAAqB,CACtDK,OAAMrB,EAAAE,EAAA,CAAA,CACR,CAAC,EACDiB,OAAOC,iBACL,uBACCH,GAAMD,EAAoBC,EAAEK,MAAM,EACnC,CACED,OAAMrB,EAAAE,EAAA,CAAA,CACR,CACF,CAAE,CAAA,CAAA,EAAAqB,EAAAvB,EAAAE,EAAAA,CAAAA,EAAAO,IAAA,CAAAT,EAAAE,EAAA,CAAA,EAAAF,EAAAE,EAAA,CAAA,EAAAM,EAAAN,CAAA,EAAAG,EAAAH,EAAAO,EAAAe,KAAA,EAAAvB,EAAAC,EAAAO,EAAAI,GAAA,CAAA,EAAA,IAAAR,CAAA,EAAA,SAAAD,EAAA,CAAA,EAAAD,CAAA,EAAA,CAAA,OAG6B,SAACe,EAAQ,CACxCA,EAAWJ,KAAKW,UAAUP,CAAQ,EAClCP,aAAae,QAAQvB,EAAWe,CAAQ,EACxCC,OAAOQ,cACL,IAAIC,YAAY,uBAAwB,CACtCN,OAAQ,CACNT,IAAKV,EACLe,SAAAA,EACAW,YAAalB,YACf,CACF,CAAC,CACH,CACD,CAAA,CAAAX,EAAA,KAAAI,CAAA"}